Model fitting
===============

imGLAD attempts to solve a binary classification problem. The positive examples in this case are all the samples were the target genome is present. The negative examples are all the samples were the negative genome is absent. ``fitModel.py`` generates a series of metagenomic datasets, 50% of this metagenomic datasets will contain reads from the target genome, these are labeled as positive samples.  The remaining 50% will **not** contain any reads from the target genome. These sets of samples are used to separate positive from negative samples using a logistic model. 

General options
---------------
For a target genome a logistic model is built. The target genome is provided in a Fasta file. The associated options are.

-t      The target genome to be detected in FASTA format.
-sp     The species of the genome written as binomial name in quotations. (e.g. "Escherichia coli")

The option ``-t`` refers to the file of the target genome. The option ``-sp`` refers to the species name, this field is used to avoid the inclusion of closely related gnoes in the training set (see below). If the species name is unknown this field can be left blank ``''``.

The training dataset
--------------------
Metagenomic datasets are generated by random generation of reads from the selected genomes. The associated options are.

-l GENOMES      The genomes list to create the training dataset
-s TRAIN_SIZE   Number of genomes included in the training dataset (Incompatible with -l). (default : 200)
-e TRAINING_EXAMPLES    Number of training examples (metagenomic datasets) used to train the model by default 200 (100 positive and 100 negative examples. (default : 100)
-j PLATFORM     The sequencing platform used to generate the reads in the datasets. (default : illumina)
-r NUM_READS    Number of reads per training example (Metagenomic dataset simulated). (default : 1000000)
-d READ_LENGTH  Average read length for the simulated datasets. (default : 150)

Using your own list of genomes
------------------------------
If you need a simulated metagenome with a specific set of genomes from NCBI you can provide imGLAD with a specific list of the accesion numbers for the genomes. imGLAD will download the genomes in the list and create metagenomic datasets with only these genomes in order to train the model. The target model needs to be provided in a separate file.

Example 1
_________
A genome list could be the following.

::

        GCA_000148745.1
        GCA_000521945.1
        GCA_000492815.1
        GCA_001444575.1
        GCA_000007845.1

Which will include genomes from:

::

        Pseudomonas aeruginosa 39016
        Citrobacter freundii UCI 32
        Klebsiella oxytoca MGH 42
        Clostridium sporogenes
        Bacillus anthracis str. Ames

A simple run of ``fitModel.py`` could be:

``$>./fitModel.py -t genome.fa -sp 'Escherichia coli' -l genomes.txt``


This will create a model for *Escherichia coli*, from the target ``genome.fa`` and the genome list ``genomes.txt``.

Using random genomes from NCBI
------------------------------
If you don't have any preference regarding the genomes used to build the training set, imGLAD can built a model with a random number of genomes from NCBI, the user can prive the number of genomes to be used.

Example 2
_________

``$>./fitModel.py -t genome.fa -sp 'Escherichia coli' -s 100``

This will create a model for *Escherichia coli*, from the target ``genome.fa`` using 100 randomly selected genomes from NCBI as background metagenomic signal.

Output files
------------
::
        
        parameters.txt
        trainingGenomes.txt
        detectionLimit.txt

After running ``fitModel.py`` 3 files will be created in your working directory. a ``parameters.txt`` file will contain the values for the regresssion parameters of the model, this file should be provided to ``probEstimate.py`` as an input under the option ``-p``. Additionally a file ``trainingGenomes.txt`` is also created, this file will contain a list of the files used to create the training set. This should give you an idea of the complexity and diversity under which the model was created. Finally a ``detectionLimit.txt`` file, this file will include a calculation for the detection limit with a 95% confidence.

General use examples
--------------------

Example 3
_________

``$>./fitModel.py -t genome.fa -sp 'Escherichia coli' -e 100``

Specifying ``-e`` instructs ``fitModel.py`` to create a given number of training metagenomic datasets, the value specified with ``-e`` represents the number of positive and negative metagenomic datasets (with and withoureads from the target genome respectively). The default is to create 100 of each.

**NOTE:** A small numnber of training examples will take less computational resources (disk space and running time) but will likely yield inaccurate results. Perfect separation errors can occur as a consequence of small values of ``-e``. This means that the positive and negative datasets are too far apart for imGLAD to establish a detection limit. If you get this error you should increase the training dataset size by increasing the value of ``-e``

Example 4
_________

``$>./fitModel.py -t genome.fa -sp 'Escherichia coli' -j illumina``

Specifying ``-j`` instructs ``fitModel.py`` to use a specific platform for read generation in this case Illumina. Altough solid and Roche 454 technologies are also available.

Example 5
_________

``$>./fitModel.py -t genome.fa -sp 'Escherichia coli' -r 1000000``

Specifying ``-r`` instructs ``fitModel.py`` to generate a particular number of reads in each training example. The  default is 1 millon.

Example 6
_________

``$>./fitModel.py -t genome.fa -sp 'Escherichia coli' -d 150``

Specifying ``-d`` designates the length of the reads in the training datasets.
